{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Kaos Data Source",
  "type": "object",
  "required": ["name", "fetch", "schedule", "redis"],
  "properties": {
    "name": {
      "type": "string",
      "description": "Unique identifier for this data source"
    },
    "description": {
      "type": "string"
    },
    "enabled": {
      "type": "boolean",
      "default": true
    },
    "fetch": {
      "type": "object",
      "required": ["url"],
      "properties": {
        "url": { "type": "string" },
        "method": { "type": "string", "default": "GET" },
        "headers": { "type": "object" },
        "timeout": { "type": "number", "default": 30000 }
      }
    },
    "schedule": {
      "type": "object",
      "required": ["intervalMs", "ttlSeconds"],
      "properties": {
        "intervalMs": { "type": "number" },
        "ttlSeconds": { "type": "number" }
      }
    },
    "redis": {
      "type": "object",
      "required": ["key"],
      "properties": {
        "key": { "type": "string" }
      }
    },
    "transform": {
      "type": "object",
      "properties": {
        "dataPath": {
          "type": "string",
          "description": "Dot path to data array in response (e.g., 'results' or 'data.items')"
        },
        "fields": {
          "type": "object",
          "description": "Map output field names to source field names"
        },
        "filter": {
          "type": "object",
          "description": "Filter conditions (e.g., { 'status': 'active' })"
        }
      }
    },
    "auth": {
      "type": "object",
      "properties": {
        "type": { "type": "string", "enum": ["bearer", "basic", "apikey"] },
        "envVar": { "type": "string", "description": "Environment variable name" },
        "header": { "type": "string", "description": "Header name for API key auth" }
      }
    }
  }
}
